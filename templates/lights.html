<!DOCTYPE html>
<html>
<head>
    <title>Lights Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        async function toggleLight(entity_id, btn) {
            btn.disabled = true;
            const res = await fetch(`/toggle/${entity_id}`);
            if(res.ok){
                btn.classList.toggle("btn-warning");
                btn.classList.toggle("btn-secondary");
                const name = btn.getAttribute("data-name");
                btn.innerText = btn.classList.contains("btn-warning") ? `${name} - ON` : `${name} - OFF`;
            }
            btn.disabled = false;
        }

        async function refreshStatus() {
            const res = await fetch("/lights_status");
            if(res.ok){
                const data = await res.json();
                data.forEach(light => {
                    const btn = document.getElementById(light.entity_id);
                    if(btn){
                        const name = btn.getAttribute("data-name");
                        if(light.state){
                            btn.classList.add("btn-warning");
                            btn.classList.remove("btn-secondary");
                            btn.innerText = `${name} - ON`;
                        } else {
                            btn.classList.add("btn-secondary");
                            btn.classList.remove("btn-warning");
                            btn.innerText = `${name} - OFF`;
                        }
                    }
                });
            }
        }

        setInterval(refreshStatus, 5000);
    </script>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">Lights Control</h1>
        <div class="row justify-content-center g-3">
            {% for light in lights %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex justify-content-center">
                    <button id="{{ light.entity_id }}"
                            data-name="{{ light.name }}"
                            class="btn {% if light.state %}btn-warning{% else %}btn-secondary{% endif %} btn-lg w-100"
                            onclick="toggleLight('{{ light.entity_id }}', this)">
                        {{ light.name }} - {% if light.state %}ON{% else %}OFF{% endif %}
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>
